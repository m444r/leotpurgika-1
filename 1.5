#!/bin/bash

# Συνάρτηση: Κατηγοριοποίηση ηλικιακών ομάδων
generate_age_groups() {
  local input_file="passengers.csv"
  local output_file="ages.txt"

  awk -F';' '
  BEGIN {
    print "Ηλικιακές ομάδες:" > "'$output_file'"
    print "-----------------" >> "'$output_file'"
  }
  {
    if ($3 <= 18) 
      group="0-18";
    else if ($3 <= 35) 
      group="19-35";
    else if ($3 <= 50) 
      group="36-50";
    else 
      group="51+";

    print $2 " (Ηλικία: " $3 ") -> Ομάδα: " group >> "'$output_file'"
  }' "$input_file"
}

# Συνάρτηση: Υπολογισμός ποσοστών διάσωσης ανά ηλικιακή ομάδα
calculate_rescue_percentages() {
  local input_file="passengers.csv"
  local output_file="percentages.txt"

  awk -F';' '{
    if ($3 <= 18) { total_18++; if ($6 == "Yes") rescued_18++ }
    else if ($3 <= 35) { total_35++; if ($6 == "Yes") rescued_35++ }
    else if ($3 <= 50) { total_50++; if ($6 == "Yes") rescued_50++ }
    else { total_51++; if ($6 == "Yes") rescued_51++ }
  }
  END {
    print "0-18: " (rescued_18/total_18)*100 "%" > "'$output_file'"
    print "19-35: " (rescued_35/total_35)*100 "%" >> "'$output_file'"
    print "36-50: " (rescued_50/total_50)*100 "%" >> "'$output_file'"
    print "51+: " (rescued_51/total_51)*100 "%" >> "'$output_file'"
  }' "$input_file"
}

# Συνάρτηση: Υπολογισμός μέσης ηλικίας ανά κατηγορία
calculate_average_age() {
  local input_file="passengers.csv"
  local output_file="avg.txt"

  awk -F';' '{
    if ($3 <= 18) { sum_18+=$3; count_18++ }
    else if ($3 <= 35) { sum_35+=$3; count_35++ }
    else if ($3 <= 50) { sum_50+=$3; count_50++ }
    else { sum_51+=$3; count_51++ }
  }
  END {
    print "0-18: " sum_18/count_18 > "'$output_file'"
    print "19-35: " sum_35/count_35 >> "'$output_file'"
    print "36-50: " sum_50/count_50 >> "'$output_file'"
    print "51+: " sum_51/count_51 >> "'$output_file'"
  }' "$input_file"
}

# Συνάρτηση: Δημιουργία αναφορών
generate_reports() {
  echo "Δημιουργία αναφορών..."
  
  generate_age_groups
  calculate_rescue_percentages
  calculate_average_age

  echo "Οι αναφορές δημιουργήθηκαν!"
}

# Έλεγχος argument
if [ "$1" == "reports" ]; then
  generate_reports
else
  echo "Άγνωστη επιλογή: $1"
  echo "Χρήση: ./processes_ipc.sh reports"
fi
